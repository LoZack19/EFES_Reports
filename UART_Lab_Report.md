# UART Lab Report

The **goal** of the UART Software laboratory was to design a driver which implments the UART protocol to handle UART communication through GPIO pins.

## Project 1 - Environment Configuration

The **goal** of this project was to write a working hello world project in C running on the Nios II processor by using the `printf()` function, in order to check wether the environment worked correctly before starting to work on the actual assignments.

The first step was to flash the Nios II processor generated with Platform Designer onto the Altera DE1-SoC board.

The second step was to create a new project with the _Nios II Software Build Tools for Eclipse_ from the Board Support Package (BSP) template generated by Platform Designer.

The third step was to configure the Board Support Package (BSP) correctly through the BSP editor, as detailed by the lab instructions.

- `stdout` set to `jtag_uart_0`
- `sys_clk_timer` set to `none`
- `timestamp_timer` set to `timer_0`

After this, it was possible to generate the BSP.

We built the whole project with the following `main()` function.

```c
#include <stdio.h>

int main() {
    printf("Hello, World!\n");
}
```

## Project 2 - Experimenting with GPIO pins

The **goal** of this project was simply to periodically complement the logic value on a pin on the right header connector and display the result on the oscilloscope. 
 
We wrote the following program to accomplish this task:  
 
```c 
#include <stdio.h>
#include <stdint.h>
#include "system.h"
#include "sys/alt_timestamp.h"
#include "altera_avalon_pio_regs.h"
 
void wait_us(uint32_t time_us) {
    uint32_t tps = alt_timestamp_freq();
    uint32_t nticks = tps / 1000000 * time_us;
 
    alt_timestamp_start();
    while(alt_timestamp() < nticks);
}
 
int main()
{
    int val = 1;
    while(1) {
        wait_us(1000);
        IOWR_ALTERA_AVALON_PIO_DATA(NIOS_HEADER_CONN_BASE, val);
        val ^= 1;
    }

    return 0;
}
```

The function `wait_us` starts the timestamp counter and busy waits until the required number of ticks have passed. 
 
The `main` function is simply an infinite loop that waits for one second and flips the value of the first pin of the header connector with a logical xor. As shown in the picture below, we managed to measure the waveform generated by such an operation: 

By connecting the oscilloscope probe to pin 0 of GPIO1 and GND we could see the voltage toggling with the expected period of $2000 ms$

![GPIO1(0) toggling](pics/lab2_proj2_oscilloscope.png)